<%- include('../partials/header') %>

<h1 class="header center">Reviews</h1>
<div class="parallax-container">
    <div class="parallax"><img src="https://i.imgur.com/685de8s.png" ></div>
</div>
<table class="striped responsive-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Address</th>
        <th>Pricey?</th>
        <th>Two Drink Min?</th>
        <th>Added on: </th>
        <th>Upcoming Events</th>
      </tr>
    </thead>
    <br>
    <tbody>
        <tr>
            <td><%= venue.name %></td>
            <td><%= venue.address %></td>
            <td><%= venue.priceTix %></td>
            <td><%= venue.twoDrink ? 'Yep' : 'Nah' %></td>
            <td><%= venue.createdAt.toLocaleDateString() %></td>
        </tr><br><br>
    </tbody>
</table>
<h3 class="center-align card-panel">Reviews</h3>
    <div class="row center">
        <form id="add-review-form" action="/venues/<%= venue._id %>/reviews" class="center-align" method="POST">
            <label class="input-field col s12">Review:</label>
            <textarea class="materialize-textarea" name="content"></textarea>
            <label class="input-field col s12">Rating:</label>
                <select name="rating">
                    <option value="" disabled selected>Choose 1-5</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            <input type="submit" value="Add Review" id="download-button" class="btn-large waves-effect waves-light teal lighten-1">
        </form>
    </div>
    <% if (venue.reviews.length) { %>
        <table>
          <thead>
            <tr>
                 <th>Date</th>
              <th>Review</th>
              <th>Rating</th>
            </tr>
          </thead>
          <tbody>
            <% let total = 0 %>
            <% venue.reviews.forEach(function(r) { %>
              <% total += r.rating %>
              <tr>
                <td><%= r.createdAt.toLocaleDateString() %></td>
                <td><%= r.content %></td>
                <td><%= r.rating %></td>
            </tr>
            <!-- user must match with who created the review NOT ANY (user) -->
            <!--  if (r.createdBy.equals(user && user._id)) { %> -->
                <form action="/reviews/<%= r._id %>?_method=PUT" method="POST">
                    <!-- Value attribute is being set to the comment's current text -->
                    <br><br><label>Edit: </label>
                    <textarea name="content"><%= r.content %></textarea>
                    <label>Rating: </label>
                    <select name="rating">
                        <option value="" disabled selected>Choose 1-5</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    <input type="submit" value="Edit Review" id="download-button" class="btn-large waves-effect waves-light teal lighten-1">
                  </form>
            <!-- }; %> -->
              <% }); %>
              <tr>
                <td colspan="2"></td>
                <td><strong><%= (total / venue.reviews.length).toFixed(1) %></strong></td>
              </tr>
          </tbody>
        </table>
      <% } else { %>
        <h5>No Reviews Yet</h5>
      <% } %>
      

<%- include('../partials/footer') %>